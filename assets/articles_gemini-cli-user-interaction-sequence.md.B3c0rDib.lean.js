import{_ as s,C as p,c as E,o as r,j as a,b as o,ah as c,a as i,w as t,G as l,ai as A}from"./chunks/framework.CDWSO0OB.js";const P=JSON.parse('{"title":"Gemini CLI 用户交互时序图","description":"","frontmatter":{},"headers":[],"relativePath":"articles/gemini-cli-user-interaction-sequence.md","filePath":"articles/gemini-cli-user-interaction-sequence.md","lastUpdated":1752132899000}'),m={name:"articles/gemini-cli-user-interaction-sequence.md"};function u(d,e,C,h,g,T){const n=p("Mermaid");return r(),E("div",null,[e[6]||(e[6]=a("h1",{id:"gemini-cli-用户交互时序图",tabindex:"-1"},[i("Gemini CLI 用户交互时序图 "),a("a",{class:"header-anchor",href:"#gemini-cli-用户交互时序图","aria-label":'Permalink to "Gemini CLI 用户交互时序图"'},"​")],-1)),e[7]||(e[7]=a("h2",{id:"_1-完整用户对话流程-complete-user-conversation-flow",tabindex:"-1"},[i("1. 完整用户对话流程 (Complete User Conversation Flow) "),a("a",{class:"header-anchor",href:"#_1-完整用户对话流程-complete-user-conversation-flow","aria-label":'Permalink to "1. 完整用户对话流程 (Complete User Conversation Flow)"'},"​")],-1)),(r(),o(A,null,{default:t(()=>[l(n,{id:"mermaid-6",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%20as%20User%0A%20%20%20%20participant%20Terminal%20as%20Terminal%0A%20%20%20%20participant%20App%20as%20App%0A%20%20%20%20participant%20Config%20as%20Config%0A%20%20%20%20participant%20Chat%20as%20GeminiChat%0A%20%20%20%20participant%20ContentGen%20as%20ContentGenerator%0A%20%20%20%20participant%20ToolReg%20as%20ToolRegistry%0A%20%20%20%20participant%20Tool%20as%20Tool%0A%20%20%20%20participant%20GeminiAPI%20as%20Gemini%20API%0A%0A%20%20%20%20User-%3E%3ETerminal%3A%20Start%20gemini%20command%0A%20%20%20%20Terminal-%3E%3EApp%3A%20Initialize%20application%0A%20%20%20%20App-%3E%3EConfig%3A%20Load%20config%20and%20auth%0A%20%20%20%20Config-%3E%3EApp%3A%20Configuration%20complete%0A%20%20%20%20App-%3E%3ETerminal%3A%20Show%20welcome%20screen%0A%0A%20%20%20%20loop%20Conversation%20Loop%0A%20%20%20%20%20%20%20%20User-%3E%3ETerminal%3A%20Input%20query%2Fcommand%0A%20%20%20%20%20%20%20%20Terminal-%3E%3EApp%3A%20Process%20user%20input%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20Slash%20command%20processing%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3EApp%3A%20Handle%20special%20commands%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3ETerminal%3A%20Show%20command%20result%0A%20%20%20%20%20%20%20%20else%20Normal%20conversation%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3EChat%3A%20Send%20user%20message%0A%20%20%20%20%20%20%20%20%20%20%20%20Chat-%3E%3EContentGen%3A%20Generate%20content%20request%0A%20%20%20%20%20%20%20%20%20%20%20%20ContentGen-%3E%3EGeminiAPI%3A%20Call%20Gemini%20API%0A%20%20%20%20%20%20%20%20%20%20%20%20GeminiAPI--%3E%3EContentGen%3A%20Return%20response%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20alt%20Contains%20tool%20calls%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ContentGen-%3E%3EToolReg%3A%20Execute%20tool%20calls%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ToolReg-%3E%3ETool%3A%20Call%20specific%20tool%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt%20Requires%20user%20confirmation%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Tool-%3E%3EApp%3A%20Request%20confirmation%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3ETerminal%3A%20Show%20confirmation%20dialog%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal-%3E%3EUser%3A%20Show%20tool%20execution%20details%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20User-%3E%3ETerminal%3A%20Confirm%2FCancel%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal-%3E%3EApp%3A%20User%20choice%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3ETool%3A%20Pass%20confirmation%20result%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Tool--%3E%3EToolReg%3A%20Return%20tool%20result%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ToolReg--%3E%3EContentGen%3A%20Tool%20execution%20complete%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ContentGen-%3E%3EGeminiAPI%3A%20Send%20tool%20results%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20GeminiAPI--%3E%3EContentGen%3A%20Final%20response%0A%20%20%20%20%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20ContentGen--%3E%3EChat%3A%20Content%20generation%20complete%0A%20%20%20%20%20%20%20%20%20%20%20%20Chat--%3E%3EApp%3A%20Response%20ready%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3ETerminal%3A%20Render%20response%20content%0A%20%20%20%20%20%20%20%20%20%20%20%20Terminal-%3E%3EUser%3A%20Display%20AI%20response%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A%0A%20%20%20%20User-%3E%3ETerminal%3A%20Ctrl%2BC%20or%20exit%20command%0A%20%20%20%20Terminal-%3E%3EApp%3A%20Exit%20signal%0A%20%20%20%20App-%3E%3EConfig%3A%20Cleanup%20resources%0A%20%20%20%20App-%3E%3ETerminal%3A%20Application%20shutdown%0A"})]),fallback:t(()=>e[0]||(e[0]=[i(" Loading... ")])),_:1})),e[8]||(e[8]=a("h2",{id:"_2-工具调用确认流程-tool-call-confirmation-flow",tabindex:"-1"},[i("2. 工具调用确认流程 (Tool Call Confirmation Flow) "),a("a",{class:"header-anchor",href:"#_2-工具调用确认流程-tool-call-confirmation-flow","aria-label":'Permalink to "2. 工具调用确认流程 (Tool Call Confirmation Flow)"'},"​")],-1)),(r(),o(A,null,{default:t(()=>[l(n,{id:"mermaid-10",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%20as%20User%0A%20%20%20%20participant%20App%20as%20App%0A%20%20%20%20participant%20ToolExecutor%20as%20ToolExecutor%0A%20%20%20%20participant%20Tool%20as%20Tool%0A%20%20%20%20participant%20FileSystem%20as%20FileSystem%0A%0A%20%20%20%20App-%3E%3EToolExecutor%3A%20Execute%20tool%20call%20request%0A%20%20%20%20ToolExecutor-%3E%3ETool%3A%20shouldConfirmExecute(params)%0A%20%20%20%20Tool--%3E%3EToolExecutor%3A%20Return%20confirmation%20details%0A%0A%20%20%20%20alt%20Requires%20confirmation%0A%20%20%20%20%20%20%20%20ToolExecutor-%3E%3EApp%3A%20Request%20user%20confirmation%0A%20%20%20%20%20%20%20%20App-%3E%3EUser%3A%20Show%20tool%20details%20and%20confirmation%20dialog%0A%20%20%20%20%20%20%20%20Note%20over%20User%2CApp%3A%20Display%3A%20tool%20name%2C%20params%2C%20expected%20operation%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20User-%3E%3EApp%3A%20Choose%20confirm%2Fcancel%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20User%20confirms%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3EToolExecutor%3A%20Confirm%20execution%0A%20%20%20%20%20%20%20%20%20%20%20%20ToolExecutor-%3E%3ETool%3A%20execute(params%2C%20signal)%0A%20%20%20%20%20%20%20%20%20%20%20%20Tool-%3E%3EFileSystem%3A%20Execute%20actual%20operation%0A%20%20%20%20%20%20%20%20%20%20%20%20FileSystem--%3E%3ETool%3A%20Operation%20result%0A%20%20%20%20%20%20%20%20%20%20%20%20Tool--%3E%3EToolExecutor%3A%20Tool%20execution%20result%0A%20%20%20%20%20%20%20%20%20%20%20%20ToolExecutor--%3E%3EApp%3A%20Execution%20complete%0A%20%20%20%20%20%20%20%20else%20User%20cancels%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3EToolExecutor%3A%20Cancel%20execution%0A%20%20%20%20%20%20%20%20%20%20%20%20ToolExecutor--%3E%3EApp%3A%20Execution%20cancelled%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20else%20Auto%20execute%20(read-only)%0A%20%20%20%20%20%20%20%20ToolExecutor-%3E%3ETool%3A%20execute(params%2C%20signal)%0A%20%20%20%20%20%20%20%20Tool-%3E%3EFileSystem%3A%20Execute%20operation%0A%20%20%20%20%20%20%20%20FileSystem--%3E%3ETool%3A%20Operation%20result%0A%20%20%20%20%20%20%20%20Tool--%3E%3EToolExecutor%3A%20Tool%20execution%20result%0A%20%20%20%20%20%20%20%20ToolExecutor--%3E%3EApp%3A%20Execution%20complete%0A%20%20%20%20end%0A"})]),fallback:t(()=>e[1]||(e[1]=[i(" Loading... ")])),_:1})),e[9]||(e[9]=a("h2",{id:"_3-认证流程-authentication-flow",tabindex:"-1"},[i("3. 认证流程 (Authentication Flow) "),a("a",{class:"header-anchor",href:"#_3-认证流程-authentication-flow","aria-label":'Permalink to "3. 认证流程 (Authentication Flow)"'},"​")],-1)),(r(),o(A,null,{default:t(()=>[l(n,{id:"mermaid-14",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%20as%20User%0A%20%20%20%20participant%20App%20as%20App%0A%20%20%20%20participant%20AuthManager%20as%20AuthManager%0A%20%20%20%20participant%20OAuth2Handler%20as%20OAuth2Handler%0A%20%20%20%20participant%20GeminiAPI%20as%20Gemini%20API%0A%20%20%20%20participant%20Browser%20as%20Browser%0A%0A%20%20%20%20User-%3E%3EApp%3A%20Start%20application%0A%20%20%20%20App-%3E%3EAuthManager%3A%20Check%20authentication%20status%0A%20%20%20%20%0A%20%20%20%20alt%20First%20use%20or%20token%20expired%0A%20%20%20%20%20%20%20%20AuthManager-%3E%3EApp%3A%20Authentication%20required%0A%20%20%20%20%20%20%20%20App-%3E%3EUser%3A%20Show%20authentication%20options%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20alt%20OAuth2%20authentication%0A%20%20%20%20%20%20%20%20%20%20%20%20User-%3E%3EApp%3A%20Choose%20Google%20login%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3EOAuth2Handler%3A%20Start%20OAuth%20flow%0A%20%20%20%20%20%20%20%20%20%20%20%20OAuth2Handler-%3E%3EBrowser%3A%20Open%20authentication%20URL%0A%20%20%20%20%20%20%20%20%20%20%20%20User-%3E%3EBrowser%3A%20Complete%20Google%20login%0A%20%20%20%20%20%20%20%20%20%20%20%20Browser-%3E%3EOAuth2Handler%3A%20Return%20authorization%20code%0A%20%20%20%20%20%20%20%20%20%20%20%20OAuth2Handler-%3E%3EGeminiAPI%3A%20Exchange%20access%20token%0A%20%20%20%20%20%20%20%20%20%20%20%20GeminiAPI--%3E%3EOAuth2Handler%3A%20Return%20access%20token%0A%20%20%20%20%20%20%20%20%20%20%20%20OAuth2Handler--%3E%3EAuthManager%3A%20Authentication%20complete%0A%20%20%20%20%20%20%20%20else%20API%20key%20authentication%0A%20%20%20%20%20%20%20%20%20%20%20%20User-%3E%3EApp%3A%20Input%20API%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20App-%3E%3EAuthManager%3A%20Validate%20API%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20AuthManager-%3E%3EGeminiAPI%3A%20Test%20API%20call%0A%20%20%20%20%20%20%20%20%20%20%20%20GeminiAPI--%3E%3EAuthManager%3A%20Validation%20result%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20AuthManager--%3E%3EApp%3A%20Authentication%20status%20updated%0A%20%20%20%20else%20Already%20authenticated%0A%20%20%20%20%20%20%20%20AuthManager--%3E%3EApp%3A%20Authentication%20valid%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20App-%3E%3EUser%3A%20Show%20ready%20status%0A"})]),fallback:t(()=>e[2]||(e[2]=[i(" Loading... ")])),_:1})),e[10]||(e[10]=a("h2",{id:"_4-mcp-服务器集成流程-mcp-server-integration-flow",tabindex:"-1"},[i("4. MCP 服务器集成流程 (MCP Server Integration Flow) "),a("a",{class:"header-anchor",href:"#_4-mcp-服务器集成流程-mcp-server-integration-flow","aria-label":'Permalink to "4. MCP 服务器集成流程 (MCP Server Integration Flow)"'},"​")],-1)),(r(),o(A,null,{default:t(()=>[l(n,{id:"mermaid-18",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20App%20as%20App%0A%20%20%20%20participant%20MCPClient%20as%20MCPClient%0A%20%20%20%20participant%20MCPServer%20as%20MCPServer%0A%20%20%20%20participant%20ToolRegistry%20as%20ToolRegistry%0A%20%20%20%20participant%20User%20as%20User%0A%0A%20%20%20%20App-%3E%3EMCPClient%3A%20Initialize%20MCP%20client%0A%20%20%20%20MCPClient-%3E%3EMCPServer%3A%20Connect%20to%20MCP%20server%0A%20%20%20%20MCPServer--%3E%3EMCPClient%3A%20Connection%20confirmed%0A%20%20%20%20%0A%20%20%20%20MCPClient-%3E%3EMCPServer%3A%20Request%20available%20tools%0A%20%20%20%20MCPServer--%3E%3EMCPClient%3A%20Return%20tool%20definitions%0A%20%20%20%20MCPClient-%3E%3EToolRegistry%3A%20Register%20discovered%20tools%0A%20%20%20%20ToolRegistry--%3E%3EMCPClient%3A%20Registration%20complete%0A%20%20%20%20%0A%20%20%20%20loop%20Tool%20Call%20Loop%0A%20%20%20%20%20%20%20%20User-%3E%3EApp%3A%20Request%20requiring%20MCP%20tool%0A%20%20%20%20%20%20%20%20App-%3E%3EToolRegistry%3A%20Find%20and%20execute%20tool%0A%20%20%20%20%20%20%20%20ToolRegistry-%3E%3EMCPClient%3A%20Call%20MCP%20tool%0A%20%20%20%20%20%20%20%20MCPClient-%3E%3EMCPServer%3A%20Send%20tool%20call%20request%0A%20%20%20%20%20%20%20%20MCPServer-%3E%3EMCPServer%3A%20Execute%20actual%20operation%0A%20%20%20%20%20%20%20%20MCPServer--%3E%3EMCPClient%3A%20Return%20execution%20result%0A%20%20%20%20%20%20%20%20MCPClient--%3E%3EToolRegistry%3A%20Tool%20result%0A%20%20%20%20%20%20%20%20ToolRegistry--%3E%3EApp%3A%20Complete%20execution%0A%20%20%20%20%20%20%20%20App-%3E%3EUser%3A%20Display%20result%0A%20%20%20%20end%0A"})]),fallback:t(()=>e[3]||(e[3]=[i(" Loading... ")])),_:1})),e[11]||(e[11]=a("h2",{id:"_5-流式响应处理-streaming-response-handling",tabindex:"-1"},[i("5. 流式响应处理 (Streaming Response Handling) "),a("a",{class:"header-anchor",href:"#_5-流式响应处理-streaming-response-handling","aria-label":'Permalink to "5. 流式响应处理 (Streaming Response Handling)"'},"​")],-1)),(r(),o(A,null,{default:t(()=>[l(n,{id:"mermaid-22",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%20as%20User%0A%20%20%20%20participant%20App%20as%20App%0A%20%20%20%20participant%20Chat%20as%20GeminiChat%0A%20%20%20%20participant%20GeminiAPI%20as%20Gemini%20API%0A%20%20%20%20participant%20Terminal%20as%20Terminal%0A%0A%20%20%20%20User-%3E%3EApp%3A%20Send%20long%20text%20request%0A%20%20%20%20App-%3E%3EChat%3A%20Start%20streaming%20conversation%0A%20%20%20%20Chat-%3E%3EGeminiAPI%3A%20Initiate%20streaming%20request%0A%20%20%20%20%0A%20%20%20%20loop%20Streaming%20Response%0A%20%20%20%20%20%20%20%20GeminiAPI--%3E%3EChat%3A%20Streaming%20data%20chunk%0A%20%20%20%20%20%20%20%20Chat-%3E%3EApp%3A%20Update%20streaming%20status%0A%20%20%20%20%20%20%20%20App-%3E%3ETerminal%3A%20Real-time%20render%20content%0A%20%20%20%20%20%20%20%20Terminal-%3E%3EUser%3A%20Display%20progressive%20response%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20GeminiAPI--%3E%3EChat%3A%20Stream%20ended%0A%20%20%20%20Chat-%3E%3EApp%3A%20Streaming%20complete%0A%20%20%20%20App-%3E%3ETerminal%3A%20Render%20final%20content%0A"})]),fallback:t(()=>e[4]||(e[4]=[i(" Loading... ")])),_:1})),e[12]||(e[12]=a("h2",{id:"_6-错误处理流程-error-handling-flow",tabindex:"-1"},[i("6. 错误处理流程 (Error Handling Flow) "),a("a",{class:"header-anchor",href:"#_6-错误处理流程-error-handling-flow","aria-label":'Permalink to "6. 错误处理流程 (Error Handling Flow)"'},"​")],-1)),(r(),o(A,null,{default:t(()=>[l(n,{id:"mermaid-26",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%20as%20User%0A%20%20%20%20participant%20App%20as%20App%0A%20%20%20%20participant%20ErrorHandler%20as%20ErrorHandler%0A%20%20%20%20participant%20Logger%20as%20Logger%0A%20%20%20%20participant%20Terminal%20as%20Terminal%0A%0A%20%20%20%20User-%3E%3EApp%3A%20Send%20request%20that%20causes%20error%0A%20%20%20%20App-%3E%3EApp%3A%20Error%20occurs%20during%20processing%0A%20%20%20%20App-%3E%3EErrorHandler%3A%20Handle%20error%0A%20%20%20%20ErrorHandler-%3E%3ELogger%3A%20Log%20error%20details%0A%20%20%20%20%0A%20%20%20%20alt%20Recoverable%20error%0A%20%20%20%20%20%20%20%20ErrorHandler-%3E%3EApp%3A%20Provide%20fallback%20solution%0A%20%20%20%20%20%20%20%20App-%3E%3ETerminal%3A%20Show%20warning%20and%20continue%0A%20%20%20%20%20%20%20%20Terminal-%3E%3EUser%3A%20Display%20warning%20message%0A%20%20%20%20else%20Critical%20error%0A%20%20%20%20%20%20%20%20ErrorHandler-%3E%3EApp%3A%20Graceful%20shutdown%20preparation%0A%20%20%20%20%20%20%20%20App-%3E%3ETerminal%3A%20Show%20error%20message%0A%20%20%20%20%20%20%20%20Terminal-%3E%3EUser%3A%20Display%20error%20and%20exit%20guidance%0A%20%20%20%20end%0A"})]),fallback:t(()=>e[5]||(e[5]=[i(" Loading... ")])),_:1})),e[13]||(e[13]=c("",12))])}const x=s(m,[["render",u]]);export{P as __pageData,x as default};
